<h1> Pedidos de Hoje </h1>

<% if @missing_orders_to_discount < 5 %>
  <h2> Faltam <%= @missing_orders_to_discount %> pedidos para você ganhar um desconto. </h2>
<% elsif @missing_orders_to_discount == 5 && @today_open_orders.size > 0 %>
  <h2> Esse pedido terá 20% de desconto </h2>
<% else %>
  <h2> Seu próximo pedido terá desconto </h2>
<% end %>

<% total = 0 %>

<% @today_open_orders.each do |order| %>
  <br>
  <h2><%= Restaurant.find(order.restaurant.to_i).name %> do <%= Restaurant.find(order.restaurant.to_i).Shopping.name %></h2>
  
  <% order.order_info.each_with_index do |info, index| %>
    <% dish = info[0] %>
    <% price = info[1] %>
    <% qtt = info[2] %>
    <% total += price.to_f * qtt.to_f %>
    <h2> Prato: <%= dish %>, Preço: <%= price %> | Quantidade: <%= qtt %>
      <%= link_to "Excluir", "/order/#{order.id}/#{index}", data:{confirm: "Gostaria de remover esse prato?"} %>
    </h2>
  <% end %>
<% end %>

<br>
<% if total > 0 %>
  <h2> Será acrescido um frete de R$10,00 ao valor do pedido </h2>
  <h2>O total é de R$<%= (total + @shipping).round(2) %></h2>
  <% if @missing_orders_to_discount == 5 %>
    <% total -= total * @discount %>
    <h2>O total com desconto é de R$<%= (total + @shipping).round(2) %></h2>
  <% end %>
  <div><h2><%= link_to "Finalizar Pedido(s)", "/order/confirm" %></h2></div>
<% else %>
  <h2>Você não realizou um pedido ainda.</h2>
  <h2><%= link_to "Fazer um pedido", home_index_path %></h2>
<% end %>